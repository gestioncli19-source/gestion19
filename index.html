<!doctype html>

<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gesti√≥n Candy üçÉ</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
<style>
/* FULL CSS (same as enviado por chat) */
:root{ --bg:#0f1216; --panel:#111318; --muted:#9aa4ad; --accent:#00b4ff; --accent2:#0077aa; --success:#23c552; --danger:#ff6b6b; --touch:48px; }
*{box-sizing:border-box}
html,body{height:100%}
body{ margin:0;font-family:Montserrat,system-ui,Arial;background:var(--bg);color:#e9f0f7; }
.app { display:flex; min-height:100vh; overflow-x:hidden; }
.sidebar { width:260px;background:linear-gradient(180deg,var(--panel),#0b0d11);padding:20px 18px;position:fixed;left:0;top:0;bottom:0;transform:translateX(-320px);transition:transform .38s;z-index:240; }
.sidebar.open { transform:translateX(0); }
.brand{display:flex;gap:12px;align-items:center;margin-bottom:18px}
.logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800}
.nav{display:flex;flex-direction:column;gap:6px}
.nav a{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;color:#cfe6ff;font-weight:700;text-decoration:none}
.nav a.active,.nav a:hover{background:rgba(255,255,255,0.03);color:#fff}
.menu-btn { position:fixed; right:14px; top:14px; background:linear-gradient(90deg,var(--accent),var(--accent2)); border:none; color:#fff; padding:10px 12px; border-radius:10px; cursor:pointer; z-index:260; }
main { flex:1; margin-left:20px; padding:20px 20px 80px 20px; }
header { display:flex; justify-content:space-between; align-items:center; }
.header-title { font-weight:800; font-size:20px; display:flex; align-items:center; gap:8px; }
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:14px; margin-top:14px; }
.box { background:linear-gradient(145deg,#121417,#181a1f); padding:20px; border-radius:16px; text-align:center; }
.num { font-size:28px; font-weight:800; color:var(--accent); }
.label { font-size:14px; color:var(--muted); margin-top:6px; }
.card-list { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:14px; margin-top:18px; }
.card { background:linear-gradient(180deg,#0f1418,#15181c); border-radius:12px; padding:14px; }
.info-row { display:flex; flex-direction:column; gap:8px; margin-top:12px; }
.actions { display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
.btn { padding:10px 12px; border-radius:10px; border:none; cursor:pointer; font-weight:800; font-size:13px; display:flex; gap:8px; }
.edit { background:linear-gradient(90deg,#3b82f6,#2563eb); color:#fff; }
.copy { background:linear-gradient(90deg,#9b6bff,#7c3aed); color:#fff; }
.del { background:linear-gradient(90deg,#ff7b7b,#ff3b3b); color:#fff; }
.panel { background:linear-gradient(180deg,#0f1316,#13161a); padding:14px; border-radius:12px; margin-top:14px; }
.row { display:flex; gap:10px; flex-wrap:wrap; }
.field { flex:1; display:flex; flex-direction:column; min-width:140px; }
label{ font-size:12px; color:var(--muted); margin-bottom:6px; }
input, textarea, select { padding:10px; border-radius:10px; border:none; background:#161819; color:#fff; }
textarea{ min-height:80px; resize:vertical; }
.pagination { display:flex; gap:8px; justify-content:center; margin-top:16px; }
.page-btn { padding:8px 12px; border-radius:8px; background:transparent; border:1px solid rgba(255,255,255,0.1); color:#fff; }
.page-btn.active { background:var(--accent); }
#toast { position:fixed; left:50%; transform:translateX(-50%); bottom:24px; padding:10px 14px; border-radius:10px; background:#222; color:#fff; display:none; z-index:600; }
</style>
</head>
<body class="app">
<button class="menu-btn" id="menuBtn"><i class="fa-solid fa-bars"></i></button>
<aside class="sidebar" id="sidebar">
  <div class="brand"><div class="logo">GC</div><div><div style="font-weight:800;font-size:16px">Gesti√≥n Candy üçÉ</div></div></div>
  <nav class="nav">
    <a href="#" data-view="dashboard" class="active"><i class="fa-solid fa-chart-simple"></i> Dashboard</a>
    <a href="#" data-view="clientes"><i class="fa-solid fa-users"></i> Clientes</a>
    <a href="#" data-view="nuevo"><i class="fa-solid fa-plus"></i> A√±adir cliente</a>
  </nav>
</aside>
<main>
<header>
  <div class="header-title">Gesti√≥n Candy üçÉ</div>
  <button id="refreshBtn" class="icon-btn"><i class="fa-solid fa-arrows-rotate"></i></button>
</header>
<section id="view-dashboard" class="view">
  <div class="grid">
    <div class="box" id="box-total"><div class="num" id="totalCount">0</div><div class="label">Total clientes</div></div>
    <div class="box" id="box-vigentes"><div class="num" id="vigentesCount">0</div><div class="label">Vigentes</div></div>
    <div class="box" id="box-alert"><div class="num" id="alertCount">0</div><div class="label">En alerta (3 d√≠as)</div></div>
    <div class="box" id="box-exp"><div class="num" id="expCount">0</div><div class="label">Caducados</div></div>
  </div>
</section>
<section id="view-clientes" class="view" style="display:none">
  <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
    <input id="search" placeholder="Buscar por nombre o usuario" style="flex:1;padding:12px;border-radius:10px;border:none;background:#15181b;color:#fff" />
    <button id="filterBtn" class="btn" style="background:#222;color:#fff">Orden caducidad ‚Üë/‚Üì</button>
    <button id="exportBtn" class="btn" style="background:#222;color:#fff">Exportar CSV</button>
  </div>
  <div id="clientsList" class="card-list"></div>
  <div id="pagination" class="pagination"></div>
</section>
<section id="view-nuevo" class="view" style="display:none">
  <div class="panel">
    <div style="font-weight:800;margin-bottom:8px">A√±adir / Editar cliente</div>
    <div class="row">
      <div class="field">
        <label>Nombre</label>
        <input id="n_nombre" />
      </div>
      <div class="field">
        <label>Aplicaci√≥n</label>
      <select id="n_aplicacion">
        <option value="Spinning TV">Spinning TV</option>
        <option value="Spinning IBO">Spinning IBO</option>
        <option value="Spinning MATE">Spinning MATE</option>
      </select>
    </div>
  </div>  <div class="row" style="margin-top:10px">
    <div class="field">
      <label>Precio</label>
      <input id="n_precio" />
    </div>
    <div class="field">
      <label>Caducidad</label>
      <input id="n_caducidad" type="date" />
    </div>
  </div>  <div class="row" style="margin-top:10px">
    <div class="field">
      <label>Usuario</label>
      <input id="n_usuario" />
    </div>
    <div class="field">
      <label>Contrase√±a</label>
      <input id="n_contrasena" />
    </div>
  </div>  <div style="margin-top:10px">
    <label>Recomendaciones</label>
    <textarea id="n_recomendaciones"></textarea>
  </div>  <div style="margin-top:10px">
    <label>Fecha de creaci√≥n</label>
    <input id="n_fechaCreacion" type="date" />
  </div>  <div class="form-footer">
    <button class="btn edit" id="saveBtn">Guardar</button>
    <button class="btn" id="clearBtn">Limpiar</button>
  </div>
</div>
</section><div id="toast"></div><script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

const firebaseConfig={ apiKey:"AIzaSyCA2fZvN8WVKWwEDL0z694C2o5190OMhq8", authDomain:"gestioncandy-b9356.firebaseapp.com", projectId:"gestioncandy-b9356", storageBucket:"gestioncandy-b9356.firebasestorage.app", messagingSenderId:"869982852654", appId:"1:869982852654:web:ac450321a746e62365f1bf" };

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

const sidebar=document.getElementById('sidebar');
const menuBtn=document.getElementById('menuBtn');
const links=document.querySelectorAll('.nav a');
const views=document.querySelectorAll('.view');
const toast=document.getElementById('toast');
let editingId=null;
let clients=[];
let sortAsc=true;

function showToast(msg){ toast.textContent=msg; toast.style.display='block'; setTimeout(()=>toast.style.display='none',2200); }

menuBtn.addEventListener('click',()=> sidebar.classList.toggle('open'));

links.forEach(a=>a.addEventListener('click',e=>{
  e.preventDefault();
  links.forEach(x=>x.classList.remove('active'));
  a.classList.add('active');
  const view=document.getElementById('view-'+a.dataset.view);
  views.forEach(v=>v.style.display='none');
  view.style.display='block';
  if(a.dataset.view==='clientes') loadClients();
}));

async function loadClients(){
  const q=query(collection(db,'clientes'),orderBy('caducidad'));
  const snap=await getDocs(q);
  clients=[];
  snap.forEach(d=>clients.push({id:d.id,...d.data()}));
  renderDashboard();
  renderClients();
}

function renderDashboard(){
  const hoy=new Date();
  document.getElementById('totalCount').textContent=clients.length;
  document.getElementById('vigentesCount').textContent=clients.filter(c=>new Date(c.caducidad)>=hoy).length;
  document.getElementById('alertCount').textContent=clients.filter(c=>{const diff=Math.ceil((new Date(c.caducidad)-hoy)/86400000);return diff>0&&diff<=3;}).length;
  document.getElementById('expCount').textContent=clients.filter(c=>new Date(c.caducidad)<hoy).length;
}

function renderClients(){
  const list=document.getElementById('clientsList'); list.innerHTML='';
  let sorted=[...clients].sort((a,b)=>sortAsc?new Date(a.caducidad)-new Date(b.caducidad):new Date(b.caducidad)-new Date(a.caducidad));

  sorted.forEach(c=>{
    const card=document.createElement('div'); card.className='card';
    card.innerHTML=`<div style="font-weight:700;font-size:16px;margin-bottom:6px">${c.nombre}</div>
      <div class="info-row">
        <div class="row"><span>Usuario:</span><span>${c.usuario}</span></div>
        <div class="row"><span>Contrase√±a:</span><span>${c.contrasena}</span></div>
        <div class="row"><span>Aplicaci√≥n:</span><span>${c.aplicacion}</span></div>
        <div class="row"><span>Caducidad:</span><span>${c.caducidad}</span></div>
      </div>
      <div class="actions">
        <button class="btn edit" onclick="editClient('${c.id}')"><i class='fa-solid fa-pen'></i> Editar</button>
        <button class="btn copy" onclick="copyClient('${c.id}')"><i class='fa-solid fa-copy'></i> Copiar</button>
        <button class="btn del" onclick="deleteClient('${c.id}')"><i class='fa-solid fa-trash'></i> Eliminar</button>
      </div>`;
    list.appendChild(card);
  });
}

window.editClient=function(id){
  const c=clients.find(x=>x.id===id);
  editingId=id;
  document.querySelector('[data-view=nuevo]').click();
  n_nombre.value=c.nombre;
  n_precio.value=c.precio;
  n_caducidad.value=c.caducidad;
  n_usuario.value=c.usuario;
  n_contrasena.value=c.contrasena;
  n_aplicacion.value=c.aplicacion;
  n_recomendaciones.value=c.recomendaciones;
  n_fechaCreacion.value=c.fechaCreacion;
}

window.copyClient=function(id){
  const c=clients.find(x=>x.id===id);
  navigator.clipboard.writeText(`Usuario: ${c.usuario}
Contrase√±a: ${c.contrasena}
Aplicaci√≥n: ${c.aplicacion}
Caducidad: ${c.caducidad}`);
  showToast('Copiado');
}

window.deleteClient=async function(id){
  if(!confirm('¬øEliminar cliente?')) return;
  await deleteDoc(doc(db,'clientes',id));
  showToast('Cliente eliminado');
  loadClients();
}

saveBtn.addEventListener('click',async()=>{
  const nombre=n_nombre.value.trim();
  const usuario=n_usuario.value.trim();
  if(!nombre||!usuario){showToast('Nombre y usuario obligatorios');return;}

  const data={
    nombre,
    precio:n_precio.value.trim()?n_precio.value.trim()+' ‚Ç¨':'',
    caducidad:n_caducidad.value||new Date().toISOString().split('T')[0],
    usuario,
    contrasena:n_contrasena.value.trim(),
    aplicacion:n_aplicacion.value,
    recomendaciones:n_recomendaciones.value,
    fechaCreacion:n_fechaCreacion.value||new Date().toISOString().split('T')[0]
  };

  if(editingId){ await updateDoc(doc(db,'clientes',editingId),data); showToast('Actualizado'); editingId=null; }
  else{ await addDoc(collection(db,'clientes'),data); showToast('Cliente agregado'); }

  clearForm(); loadClients(); document.querySelector('[data-view=clientes]').click();
});

function clearForm(){ ['n_nombre','n_precio','n_caducidad','n_usuario','n_contrasena','n_aplicacion','n_recomendaciones','n_fechaCreacion'].forEach(id=>document.getElementById(id).value=''); }
clearBtn.addEventListener('click',clearForm);

filterBtn.addEventListener('click',()=>{sortAsc=!sortAsc;renderClients();});
refreshBtn.addEventListener('click',loadClients);

loadClients();
</script></body>
</html>

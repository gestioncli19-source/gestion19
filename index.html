<!doctype html>

<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gestor de Clientes</title>
  <!-- CORRECCI√ìN: Usamos ruta relativa para que funcione en subcarpetas de GitHub Pages -->
  <link rel="icon" href="favicon.png" type="image/png"> 
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  
  <!-- Enlace a los archivos separados -->
  <link rel="stylesheet" href="style.css"> 
  
  <!-- √çcono de Engranaje (Font Awesome) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMDJc5fS1XCBK7Bf0N8lO+7l8r6k/5tB3zN11E48A0hP5E4d5N2v3zP1V3t5w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>

<section id="section-login" class="show">
  <div class="login-box">
    <h2>Gestor de Clientes</h2>
    <form id="form-login">
      <label for="login-email">Email</label>
      <input type="email" id="login-email" required />

      <label for="login-password" style="margin-top: 10px;">Contrase√±a</label>
      <input type="password" id="login-password" required />

      <div id="login-error-message"></div>

      <button type="submit" class="btn edit" style="width: 100%; margin-top: 15px;">Iniciar Sesi√≥n</button>
    </form>
  </div>
</section>

<div class="container" id="app-container" style="display:none;">

<header>
  <div class="brand">
    <div class="logo">GC</div>
    <div><div style="font-weight:700">Gestor Clientes</div></div>
  </div>
  <nav>
    <div class="menu">
      <button id="nav-dashboard" class="active">Dashboard</button>
      <button id="nav-clientes">Clientes</button>
      <button id="nav-add">A√±adir cliente</button>
      
      <!-- BOT√ìN DE AJUSTES (ENGRANAJE) -->
      <button id="nav-settings" title="Ajustes" style="margin-left: 12px; font-size: 1.1rem;"><i class="fas fa-cog"></i></button>
      
    </div>
  </nav>
</header>

<main>

<section id="section-dashboard">
  <div class="cards-col">
    <div class="stat stat-clickable" id="stat-total-link" title="Haz clic para ver todos los clientes.">
      <h3>Total clientes</h3><p id="stat-total">‚Äî</p>
    </div>
    <div class="stat stat-clickable" id="stat-3days-link" title="Haz clic para filtrar clientes.">
      <h3>Caducan en 3 d√≠as</h3><p id="stat-today-3days">‚Äî</p>
    </div>
    <div class="stat stat-clickable" id="stat-expired-link" title="Haz clic para filtrar clientes.">
      <h3>Cliente caducado</h3><p id="stat-expired">‚Äî</p>
    </div>
  </div>
  <div id="dashboard-soon-exp" class="cards" style="margin-top: 18px">
    <p class="meta" style="grid-column: 1 / -1; margin-bottom: 0;">Clientes que caducan en los pr√≥ximos 3 d√≠as:</p>
  </div>
</section>

<section id="section-clientes" style="display:none">
  <div class="card-form">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
      <h3>Clientes</h3>
      <!-- El bot√≥n de Exportar se mueve a Ajustes, pero dejamos este por si es necesario un Export r√°pido -->
      <!-- <button id="btn-export-csv" class="btn export">Exportar a CSV üì•</button> --> 
    </div>
    
    <input type="text" id="search-input" placeholder="Buscar por Nombre, Usuario o Aplicaci√≥n..." style="margin-bottom: 12px;" />

    <div id="clients-grid" class="grid-clients" style="margin-top:10px"></div>
  </div>
</section>

<section id="section-add" style="display:none">
  <div class="card-form">
    <h3>A√±adir cliente</h3>
    <form id="form-add">

      <label>Nombre</label>
      <input type="text" id="f-nombre" required />
      
      <label>Tel√©fono (Ej: 34600123456)</label>
      <input type="text" id="f-telefono" value="+34" placeholder="C√≥digo de pa√≠s + n√∫mero (sin espacios)" />

      <div class="row">
        <div>
          <label>Fecha de creaci√≥n</label>
          <input type="date" id="f-creacion" required />
        </div>
        <div>
          <label>Caducidad</label>
          <input type="date" id="f-caducidad" required />
        </div>
      </div>

      <label>Usuario</label>
      <input type="text" id="f-usuario" />

      <label>Contrase√±a</label>
      <input type="text" id="f-contrasena" />

      <label>Dispositivo utilizado</label>
      <input type="text" id="f-dispositivo" />

      <label>Aplicaci√≥n</label>
      <select id="f-aplicacion">
        <option value="Spinning TV">Spinning TV</option>
        <option value="Spinning IBO">Spinning IBO</option>
        <option value="Spinning Mate">Spinning Mate</option>
        <option value="Hot Player">Hot Player</option>
      </select>

      <label>Clientes recomendados</label>
      <div id="f-recomendaciones-container" class="dynamic-input-container">
          <div id="f-recommended-clients" class="tag-list"></div>
          <div class="input-add-row">
              <input type="text" id="f-new-recommendation" placeholder="Nombre de cliente recomendado" />
              <button type="button" class="btn copy" id="f-add-recommendation-btn">+</button>
              </div>
      </div>

      <div style="display:flex;gap:8px;margin-top:8px">
        <button type="submit" class="btn edit">Guardar</button>
        <button type="button" id="f-reset" class="btn copy">Reset</button>
      </div>

    </form>
  </div>
</section>

<!-- NUEVA SECCI√ìN DE AJUSTES -->
<section id="section-settings" style="display:none">
  <div class="card-form">
    <h3>‚öôÔ∏è Ajustes y Herramientas</h3>
    <div class="settings-grid">
        <!-- Importar CSV -->
        <div class="setting-item">
            <h4>Importar Clientes (CSV)</h4>
            <p>Sube un archivo CSV para a√±adir o actualizar clientes masivamente.</p>
            <button id="btn-import-csv" class="btn renew">Importar CSV ‚¨ÜÔ∏è</button>
            <input type="file" id="file-import-csv" accept=".csv" style="display:none;">
        </div>

        <!-- Exportar CSV -->
        <div class="setting-item">
            <h4>Exportar Base de Datos</h4>
            <p>Descarga una copia de seguridad completa de todos tus clientes.</p>
            <button id="btn-export-csv" class="btn export">Exportar CSV üì•</button>
        </div>

        <!-- Tutorial -->
        <div class="setting-item">
            <h4>Gu√≠a de Uso</h4>
            <p>Abre el manual de la aplicaci√≥n para revisar todas las funcionalidades.</p>
            <button id="nav-tutorial" class="btn copy">Ver Tutorial üìö</button>
        </div>

        <!-- Cerrar Sesi√≥n -->
        <div class="setting-item">
            <h4>Cerrar Sesi√≥n</h4>
            <p>Finaliza tu sesi√≥n actual de forma segura.</p>
            <button id="btn-logout-settings" class="btn delete">Cerrar Sesi√≥n üîí</button>
        </div>
    </div>
  </div>
</section>
<!-- FIN SECCI√ìN DE AJUSTES -->

<!-- SECCI√ìN TUTORIAL -->
<section id="section-tutorial" style="display:none">
    <div class="card-form">
        <h3>Gu√≠a de Uso del Gestor de Clientes</h3>
        <div style="font-size: 14px; color: var(--muted); line-height: 1.6;">
            <p style="color: var(--accent); font-weight: 600;">Bienvenido al tutorial. A continuaci√≥n, se detalla la funci√≥n de cada secci√≥n y bot√≥n de la aplicaci√≥n.</p>

            <h4>1. Dashboard (Panel Principal)</h4>
            <ul>
                <li><strong>M√©tricas:</strong> Muestra el total de clientes, activos, los que caducan en 3 d√≠as y los caducados.</li>
                <li><strong>Clientes Pr√≥ximos a Caducar:</strong> Se muestra en **fila horizontal** con un estilo √∫nico para una identificaci√≥n r√°pida.</li>
            </ul>

            <h4>2. Clientes (Listado)</h4>
            <p>Muestra todas las tarjetas de clientes. Se aplican **colores variados** en el borde izquierdo para una distinci√≥n visual del resto de la interfaz.</p>
            <ul>
                <li><strong>Bot√≥n Copiar:</strong> Copia `Usuario`, `Contrase√±a`, `Aplicaci√≥n` y `Fecha de caducidad`.</li>
                <li><strong>Bot√≥n Mes Gratis:</strong> Solo se activa si el cliente tiene **3 o m√°s recomendaciones registradas**.</li>
            </ul>

            <h4>3. Modal de Edici√≥n</h4>
            <p>La ventana de edici√≥n est√° optimizada (Scrollable y responsive) para funcionar correctamente en **m√≥vil y PC**.</p>
            <ul>
                <li><strong>Campos del Formulario:</strong> Los campos para a√±adir y editar clientes (Nombre, Tel√©fono, Caducidad, etc.) usan IDs √∫nicos internamente para evitar errores.</li>
                <li>**Tel√©fono:** El campo ya viene con el prefijo `+34` por defecto.</li>
            </ul>
        </div>
    </div>
</section>
<!-- FIN SECCI√ìN TUTORIAL -->


</main>

<footer></footer>

</div>

<div id="modal" class="modal">
  <div class="modal-inner">
    <h3 id="modal-title">Editar cliente</h3>
    <form id="form-edit">

      <label>Nombre</label>
      <input type="text" id="e-nombre" required /> 
      
      <label>Tel√©fono (Ej: 34600123456)</label>
      <input type="text" id="e-telefono" placeholder="C√≥digo de pa√≠s + n√∫mero (sin espacios)" /> 

      <div class="row">
        <div>
          <label>Fecha de creaci√≥n</label>
          <input type="date" id="e-creacion" required /> 
        </div>
        <div>
          <label>Caducidad</label>
          <input type="date" id="e-caducidad" required /> 
        </div>
      </div>

      <label>Usuario</label>
      <input type="text" id="e-usuario" /> 

      <label>Contrase√±a</label>
      <input type="text" id="e-contrasena" /> 

      <label>Dispositivo utilizado</label>
      <input type="text" id="e-dispositivo" /> 

      <label>Aplicaci√≥n</label>
      <select id="e-aplicacion"> 
        <option value="Spinning TV">Spinning TV</option>
        <option value="Spinning IBO">Spinning IBO</option>
        <option value="Spinning Mate">Spinning Mate</option>
        <option value="Hot Player">Hot Player</option>
      </select>

      <label>Clientes recomendados</label>
      <div id="e-recomendaciones-container" class="dynamic-input-container">
          <div id="e-recommended-clients" class="tag-list"></div>
          <div class="input-add-row">
              <input type="text" id="e-new-recommendation" placeholder="Nombre de cliente recomendado" />
              <button type="button" class="btn copy" id="e-add-recommendation-btn">+</button>
               </div>
      </div>

      <div style="display:flex;gap:8px;margin-top:8px;justify-content:space-between">
        <button type="button" id="btn-history-open" class="btn history">Ver Historial</button>
        <div style="display:flex;gap:8px;">
          <button type="button" id="modal-cancel" class="btn copy">Cancelar</button>
          <button type="submit" class="btn edit">Guardar cambios</button>
        </div>
      </div>
    </form>
  </div>
</div>

<div id="history-modal" class="modal">
  <div class="modal-inner history">
    <h3 id="history-modal-title">Historial de Renovaciones</h3>
    <div id="history-list" style="max-height: 400px; overflow-y: auto;">
        </div>
    <div style="text-align: right; margin-top: 15px;">
        <button type="button" id="history-modal-close" class="btn copy">Cerrar</button>
    </div>
  </div>
</div>

<div id="notifications-container"></div>


<!-- Enlace al archivo JS -->
<script type="module" src="script.js"></script>
</body>
</html>

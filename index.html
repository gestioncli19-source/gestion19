<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üóÇÔ∏è Gesti√≥n Candy</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
<style>
body{margin:0;font-family:'Montserrat',sans-serif;background:#0f121d;color:#e0e0e0;transition:0.3s;}
body.light{background:#f5f5f5;color:#222;}
header{display:flex;justify-content:space-between;align-items:center;padding:12px 20px;background:#1a1f2b;}
body.light header{background:#ddd;color:#222;}
header h1{font-size:1.5em;margin:0;transition:0.3s;}
#menuBtn{font-size:1.3em;cursor:pointer;transition:0.3s;}
.sidebar{position:fixed;right:-220px;top:0;width:220px;height:100%;background:#222;padding:20px;transition:0.5s;display:flex;flex-direction:column;gap:15px;z-index:100;}
.sidebar a{color:#fff;text-decoration:none;padding:10px;border-radius:8px;transition:0.3s;}
.sidebar a:hover,.sidebar a.active{background:#444;}
body.light .sidebar{background:#ccc;}
body.light .sidebar a{color:#222;}
main{margin-left:0;padding:20px;transition:0.3s;}
.view{opacity:0;transform:translateY(20px);transition:0.4s;}
.view.active{opacity:1;transform:translateY(0);}
.dashboard{display:flex;flex-wrap:wrap;gap:15px;margin-bottom:25px;justify-content:center;}
.dashboard .box{flex:1 1 120px;padding:15px;border-radius:12px;text-align:center;cursor:pointer;transition:0.3s;box-shadow:0 0 10px rgba(0,0,0,0.3);}
.dashboard .box h3{margin:0;font-size:14px;font-weight:600;}
.dashboard .box p{margin:5px 0 0;font-size:18px;font-weight:700;}
.box.total{background:rgba(0,180,255,0.15);color:#00b4ff;}
.box.vigente{background:rgba(0,200,0,0.15);color:#00c800;}
.box.alerta{background:rgba(255,165,0,0.15);color:#ff9900;}
.box.caducado{background:rgba(255,50,50,0.15);color:#ff4d4d;}
#clientsView{display:none;}
.card{background:#1a1f2b;color:#e0e0e0;border-radius:15px;padding:15px;margin-bottom:15px;box-shadow:0 6px 15px rgba(0,0,0,0.5);transition:0.3s;}
body.light .card{background:#eaeaea;color:#222;box-shadow:0 4px 10px rgba(0,0,0,0.15);}
.card:hover{transform:translateY(-3px);box-shadow:0 10px 20px rgba(0,0,0,0.6);}
.card .info-row{margin-bottom:10px;}
.card .info-row .row{display:flex;justify-content:space-between;margin-bottom:4px;}
.card .actions{display:flex;gap:6px;flex-wrap:wrap;}
.card .btn{padding:6px 10px;border:none;border-radius:6px;cursor:pointer;font-weight:600;transition:0.3s;}
.card .btn.edit{background:#2196F3;color:#fff;}
.card .btn.copy{background:#9C27B0;color:#fff;}
.card .btn.del{background:#f44336;color:#fff;}
.card .btn:hover{opacity:0.85;}
#addClientView{display:none;}
.form-group{margin-bottom:10px;display:flex;flex-direction:column;}
.form-group label{margin-bottom:4px;}
.form-group input,.form-group select,.form-group textarea{padding:10px;border-radius:8px;border:1px solid #444;font-size:14px;}
body.light .form-group input,body.light .form-group select,body.light .form-group textarea{background:#fff;color:#222;border:1px solid #ccc;}
#saveBtn,#clearBtn{padding:10px 15px;margin-right:6px;border:none;border-radius:8px;cursor:pointer;font-weight:600;}
#saveBtn{background:#00b4ff;color:#fff;}
#clearBtn{background:#ccc;color:#222;}
#toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:12px;border-radius:8px;display:none;z-index:300;}
@media(max-width:700px){.dashboard{flex-direction:column;}.card{width:100%;}.sidebar{width:180px;}}
</style>
</head>
<body class="dark">

<header>
  <h1>üóÇÔ∏è Gesti√≥n Candy</h1>
  <i id="menuBtn" class="fa-solid fa-bars"></i>
</header>

<div class="sidebar" id="sidebar">
  <a href="#" data-view="dashboard" class="active">Dashboard</a>
  <a href="#" data-view="clientes">Clientes</a>
  <a href="#" data-view="nuevo">A√±adir Cliente</a>
</div>

<main>
  <div id="dashboardView" class="view active">
    <div class="dashboard">
      <div class="box total"><h3>Total Clientes</h3><p id="totalCount">0</p></div>
      <div class="box vigente"><h3>Vigentes</h3><p id="vigentesCount">0</p></div>
      <div class="box alerta" onclick="mostrarAlertas()"><h3>En Alerta</h3><p id="alertCount">0</p></div>
      <div class="box caducado" onclick="mostrarCaducados()"><h3>Caducados</h3><p id="expCount">0</p></div>
    </div>
  </div>

  <div id="clientsView" class="view">
    <button id="filterBtn">Orden caducidad ‚Üë/‚Üì</button>
    <div id="clientsList"></div>
  </div>

  <div id="addClientView" class="view">
    <div class="form-group"><label>Nombre</label><input id="n_nombre" type="text"></div>
    <div class="form-group"><label>Precio</label><input id="n_precio" type="text" oninput="this.value=this.value.replace(/[^\d.,]/g,'')+' ‚Ç¨';"></div>
    <div class="form-group"><label>Caducidad</label><input id="n_caducidad" type="date"></div>
    <div class="form-group"><label>Usuario</label><input id="n_usuario" type="text"></div>
    <div class="form-group"><label>Contrase√±a</label><input id="n_contrasena" type="text"></div>
    <div class="form-group"><label>Aplicaci√≥n</label>
      <select id="n_aplicacion">
        <option value="Spinning TV">Spinning TV</option>
        <option value="Spinning IBO">Spinning IBO</option>
        <option value="Spinning MATE">Spinning MATE</option>
      </select>
    </div>
    <div class="form-group"><label>Recomendaciones</label><textarea id="n_recomendaciones"></textarea></div>
    <div class="form-group"><label>Fecha de creaci√≥n</label><input id="n_fechaCreacion" type="date"></div>
    <button id="saveBtn">Guardar Cliente</button>
    <button id="clearBtn">Limpiar</button>
  </div>
</main>

<div id="toast"></div>

<script>
let registros = JSON.parse(localStorage.getItem('registros')) || [];

const views = {
  dashboard: document.getElementById('dashboardView'),
  clientes: document.getElementById('clientsView'),
  nuevo: document.getElementById('addClientView')
};

function switchView(view){
  for(let v in views){ views[v].classList.remove('active'); document.querySelector('.sidebar a[data-view="'+v+'"]').classList.remove('active'); }
  views[view].classList.add('active');
  document.querySelector('.sidebar a[data-view="'+view+'"]').classList.add('active');
  if(view==='clientes') mostrarRegistros();
}

document.querySelectorAll('.sidebar a[data-view]').forEach(el=>{
  el.addEventListener('click',()=>switchView(el.dataset.view));
});

const menuBtn = document.getElementById('menuBtn'); 
const sidebar = document.getElementById('sidebar');
menuBtn.addEventListener('click',()=>{sidebar.style.right = sidebar.style.right==='0px'?'-220px':'0px';});

function guardarLocal(){ localStorage.setItem('registros', JSON.stringify(registros)); }
function mostrarToast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',2500); }

function mostrarRegistros(filtro=''){
  const container=document.getElementById('clientsList'); container.innerHTML='';
  let lista = registros.slice();
  lista.sort((a,b)=>new Date(a.caducidad)-new Date(b.caducidad));
  lista = lista.filter(r=> r.nombre.toLowerCase().includes(filtro.toLowerCase()) || r.usuario.toLowerCase().includes(filtro.toLowerCase()));
  lista.forEach((r,index)=>{
    const card=document.createElement('div'); card.className='card';
    const diffDias=Math.ceil((new Date(r.caducidad)-new Date())/(1000*60*60*24));
    card.innerHTML=`
      <div class="info-row"><div class="row"><strong>Nombre:</strong> <span>${r.nombre}</span></div></div>
      <div class="info-row"><div class="row"><strong>Precio:</strong> <span>${r.precio}</span></div></div>
      <div class="info-row"><div class="row"><strong>Usuario:</strong> <span>${r.usuario}</span></div></div>
      <div class="info-row"><div class="row"><strong>Contrase√±a:</strong> <span>${r.contrasena}</span></div></div>
      <div class="info-row"><div class="row"><strong>Aplicaci√≥n:</strong> <span>${r.aplicacion}</span></div></div>
      <div class="info-row"><div class="row"><strong>Caducidad:</strong> <span>${r.caducidad} (${diffDias>=0?diffDias:0} d√≠as)</span></div></div>
      <div class="info-row"><div class="row"><strong>Fecha Creaci√≥n:</strong> <span>${r.fechaCreacion||'-'}</span></div></div>
      <div class="info-row"><div class="row"><strong>Recomendaciones:</strong> <span>${r.recomendaciones||'-'}</span></div></div>
      <div class="actions">
        <button class="btn edit" onclick="editarRegistro(${index})">Editar</button>
        <button class="btn copy" onclick="copiarCliente(${index})">Copiar datos</button>
        <button class="btn del" onclick="eliminarRegistro(${index})">Eliminar</button>
      </div>
    `;
    container.appendChild(card);
  });
  actualizarDashboard();
}

function actualizarDashboard(){
  const total=document.getElementById('totalCount');
  const vigentes=document.getElementById('vigentesCount');
  const alerta=document.getElementById('alertCount');
  const caducado=document.getElementById('expCount');
  const hoy=new Date();
  total.textContent=registros.length;
  vigentes.textContent=registros.filter(r=>new Date(r.caducidad)>=hoy).length;
  alerta.textContent=registros.filter(r=>{ const diff=Math.ceil((new Date(r.caducidad)-hoy)/(1000*60*60*24)); return diff>0 && diff<=3; }).length;
  caducado.textContent=registros.filter(r=>new Date(r.caducidad)<hoy).length;
}

function mostrarAlertas(){
  const hoy=new Date();
  const alerta = registros.filter(r=>{ const diff=Math.ceil((new Date(r.caducidad)-hoy)/(1000*60*60*24)); return diff>0 && diff<=3; });
  mostrarRegistrosPorLista(alerta);
  switchView('clientes');
}

function mostrarCaducados(){
  const hoy=new Date();
  const caducados = registros.filter(r=>new Date(r.caducidad)<hoy);
  mostrarRegistrosPorLista(caducados);
  switchView('clientes');
}

function mostrarRegistrosPorLista(lista){
  const container=document.getElementById('clientsList'); container.innerHTML='';
  lista.forEach((r,index)=>{
    const card=document.createElement('div'); card.className='card';
    const diffDias=Math.ceil((new Date(r.caducidad)-new Date())/(1000*60*60*24));
    card.innerHTML=`
      <div class="info-row"><div class="row"><strong>Nombre:</strong> <span>${r.nombre}</span></div></div>
      <div class="info-row"><div class="row"><strong>Precio:</strong> <span>${r.precio}</span></div></div>
      <div class="info-row"><div class="row"><strong>Usuario:</strong> <span>${r.usuario}</span></div></div>
      <div class="info-row"><div class="row"><strong>Contrase√±a:</strong> <span>${r.contrasena}</span></div></div>
      <div class="info-row"><div class="row"><strong>Aplicaci√≥n:</strong> <span>${r.aplicacion}</span></div></div>
      <div class="info-row"><div class="row"><strong>Caducidad:</strong> <span>${r.caducidad} (${diffDias>=0?diffDias:0} d√≠as)</span></div></div>
      <div class="info-row"><div class="row"><strong>Fecha Creaci√≥n:</strong> <span>${r.fechaCreacion||'-'}</span></div></div>
      <div class="info-row"><div class="row"><strong>Recomendaciones:</strong> <span>${r.recomendaciones||'-'}</span></div></div>
      <div class="actions">
        <button class="btn edit" onclick="editarRegistro(${index})">Editar</button>
        <button class="btn copy" onclick="copiarCliente(${index})">Copiar datos</button>
        <button class="btn del" onclick="eliminarRegistro(${index})">Eliminar</button>
      </div>
    `;
    container.appendChild(card);
  });
}

// A√±adir nuevo cliente
document.getElementById('saveBtn').addEventListener('click',()=>{
  const cliente={
    nombre: document.getElementById('n_nombre').value,
    precio: document.getElementById('n_precio').value,
    caducidad: document.getElementById('n_caducidad').value,
    usuario: document.getElementById('n_usuario').value,
    contrasena: document.getElementById('n_contrasena').value,
    aplicacion: document.getElementById('n_aplicacion').value,
    recomendaciones: document.getElementById('n_recomendaciones').value,
    fechaCreacion: document.getElementById('n_fechaCreacion').value
  };
  registros.push(cliente);
  guardarLocal();
  mostrarToast('Cliente agregado');
  limpiarFormulario();
  mostrarRegistros();
  switchView('clientes');
});

function limpiarFormulario(){
  document.getElementById('n_nombre').value='';
  document.getElementById('n_precio').value='';
  document.getElementById('n_caducidad').value='';
  document.getElementById('n_usuario').value='';
  document.getElementById('n_contrasena').value='';
  document.getElementById('n_aplicacion').value='Spinning TV';
  document.getElementById('n_recomendaciones').value='';
  document.getElementById('n_fechaCreacion').value='';
}

function editarRegistro(index){
  const r = registros[index];
  document.getElementById('n_nombre').value=r.nombre;
  document.getElementById('n_precio').value=r.precio;
  document.getElementById('n_caducidad').value=r.caducidad;
  document.getElementById('n_usuario').value=r.usuario;
  document.getElementById('n_contrasena').value=r.contrasena;
  document.getElementById('n_aplicacion').value=r.aplicacion;
  document.getElementById('n_recomendaciones').value=r.recomendaciones;
  document.getElementById('n_fechaCreacion').value=r.fechaCreacion;
  switchView('nuevo');
  document.getElementById('saveBtn').onclick = ()=>{
    registros[index]={
      nombre: document.getElementById('n_nombre').value,
      precio: document.getElementById('n_precio').value,
      caducidad: document.getElementById('n_caducidad').value,
      usuario: document.getElementById('n_usuario').value,
      contrasena: document.getElementById('n_contrasena').value,
      aplicacion: document.getElementById('n_aplicacion').value,
      recomendaciones: document.getElementById('n_recomendaciones').value,
      fechaCreacion: document.getElementById('n_fechaCreacion').value
    };
    guardarLocal();
    mostrarToast('Cliente actualizado');
    mostrarRegistros();
    switchView('clientes');
    document.getElementById('saveBtn').onclick = null; // reset al comportamiento normal
  };
}

function eliminarRegistro(index){
  if(confirm('¬øEliminar cliente?')){
    registros.splice(index,1);
    guardarLocal();
    mostrarToast('Cliente eliminado');
    mostrarRegistros();
  }
}

function copiarCliente(index){
  const c = registros[index];
  const texto = `Usuario: ${c.usuario}\nContrase√±a: ${c.contrasena}\nAplicaci√≥n: ${c.aplicacion}\nCaducidad: ${c.caducidad}`;
  navigator.clipboard.writeText(texto).then(()=>mostrarToast('Datos copiados'));
}

// Filtro ascendente/descendente por caducidad
let ascendente=true;
document.getElementById('filterBtn').addEventListener('click',()=>{
  registros.sort((a,b)=>{
    const da=new Date(a.caducidad), db_=new Date(b.caducidad);
    return ascendente ? da-db_ : db_-da;
  });
  ascendente=!ascendente;
  mostrarRegistros();
});

// Inicializaci√≥n con cliente de prueba si no hay registros
if(registros.length===0){
  registros.push({
    nombre:'Cliente Prueba',
    precio:'10 ‚Ç¨',
    caducidad:new Date(new Date().setDate(new Date().getDate()+7)).toISOString().split('T')[0],
    usuario:'userprueba',
    contrasena:'pass123',
    aplicacion:'Spinning TV',
    recomendaciones:'Prueba inicial',
    fechaCreacion:new Date().toISOString().split('T')[0]
  });
  guardarLocal();
}

mostrarRegistros();
</script>
</body>
</html>
